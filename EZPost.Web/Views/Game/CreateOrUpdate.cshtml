
@{
    ViewBag.Title = "CreateOrUpdate";
}
<link href="~/Content/webuploader/webuploader.css" rel="stylesheet" />
<div class="panel-body">
    <form id="Form" role="form"  class="form-horizontal">
        <div class="form-group">
            <label class="col-sm-2 control-label">游戏名称</label>
            <div class="col-sm-6">
                <input class="form-control"  type="text" v-model="model.gameName">
            </div>
        </div>
        <div class="form-group">
            <label class="col-sm-2 control-label">上传图片</label>
            <div class="col-sm-6">
                <div id="uploader-demo">
                    <input type="hidden" id="hdfImageUrl" />
                    <img id="imgShow" v-if="model.gamePic!=null"  width="200" v-bind:src="model.gamePic"/>
                    <img id="imgShow" v-else  width="200" />
                    <!--用来存放item-->
                    <div id="filePicker">选择图片</div>
                </div>
            </div>
        </div>
    </form>
</div>
<script src="~/Content/vue/vue.js"></script>
<script src="~/Content/webuploader/webuploader.nolog.min.js"></script>
<script src="~/Scripts/UpLoadImgage.js"></script>
@section scripts{
    <script>
        var gameService = abp.services.app.game;
        var vue = new Vue({
            el: "#Form",
            data: {
                id: '@Model',
                model:{}
            },
            methods: {
                init: function () {
                    webPicUploader('#filePicker', '#imgShow', '#hdfImageUrl');
                    var _this = this;
                    abp.ui.setBusy();
                    gameService.getEdit(_this.id).done(function (result) {
                        console.log(result.game);
                        _this.model = result.game;
                        //$("#hdfImageUrl").val(result.game.gamePic);
                    }).always(function() {
                        abp.ui.clearBusy();
                    });
                },
                save:function() {
                    abp.ui.setBusy();
                    this.model.gamePic = $("#hdfImageUrl").val();
                    gameService.createOrUpdate({
                        game:this.model
                    }).done(function () {
                        abp.message.success("保存成功");
                        $.currentIframe().$("#gameTable").DataTable().ajax.reload();
                        dialogClose();
                    }).always(function () {
                        abp.ui.clearBusy();
                    });
                }
            }
        });
        vue.init();
    </script>
}

